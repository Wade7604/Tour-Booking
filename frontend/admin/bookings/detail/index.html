<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Booking Detail - Admin Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/assets/css/admin.css" />
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="d-flex justify-content-between align-items-center mb-3 px-2">
        <h4 class="mb-0">
          <i class="bi bi-gear-fill"></i>
          <span class="sidebar-text">Admin Panel</span>
        </h4>
        <button class="btn btn-sm btn-outline-primary" onclick="toggleSidebar()">
          <i class="bi bi-list"></i>
        </button>
      </div>
      <nav class="nav flex-column">
        <a class="nav-link" href="/admin/index.html">
          <i class="bi bi-speedometer2"></i>
          <span class="sidebar-text">Dashboard</span>
        </a>
        <a
          class="nav-link"
          href="/admin/users/index.html"
          data-permission="user:view"
        >
          <i class="bi bi-people-fill"></i>
          <span class="sidebar-text">Users</span>
        </a>
        <a
          class="nav-link"
          href="/admin/roles/index.html"
          data-permission="role:view"
        >
          <i class="bi bi-shield-fill"></i>
          <span class="sidebar-text">Roles</span>
        </a>
        <a
          class="nav-link"
          href="/admin/permissions/index.html"
          data-permission="permission:view"
        >
          <i class="bi bi-key-fill"></i>
          <span class="sidebar-text">Permissions</span>
        </a>
        <a
          class="nav-link"
          href="/admin/destinations/index.html"
          data-permission="destination:view"
        >
          <i class="bi bi-geo-alt-fill"></i>
          <span class="sidebar-text">Destinations</span>
        </a>
        <a
          class="nav-link"
          href="/admin/tours/index.html"
          data-permission="tour:view"
        >
          <i class="bi bi-map-fill"></i> <span class="sidebar-text">Tours</span>
        </a>
        <a
          class="nav-link active"
          href="/admin/bookings/index.html"
          data-permission="booking:view"
        >
          <i class="bi bi-calendar-check-fill"></i>
          <span class="sidebar-text">Bookings</span>
        </a>
        <hr style="border-color: rgba(255, 255, 255, 0.3); margin: 20px 0" />
        <a class="nav-link" href="/index.html">
          <i class="bi bi-house-fill"></i>
          <span class="sidebar-text">Back to Home</span>
        </a>
        <a class="nav-link" href="#" onclick="AdminUtils.logout()">
          <i class="bi bi-box-arrow-right"></i>
          <span class="sidebar-text">Logout</span>
        </a>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
              <a href="../index.html" class="text-decoration-none text-muted mb-2 d-block"><i class="bi bi-arrow-left"></i> Back to List</a>
              <h2 class="d-flex align-items-center gap-3">
                  Booking Detail <span id="bookingCode" class="text-primary"></span>
                  <div id="bookingStatus"></div>
              </h2>
          </div>
          
           <div class="text-muted" id="bookingDate"></div>
        </div>

        <div class="row">
            <!-- Left Column: Customer & Tour -->
            <div class="col-md-8">
                <!-- Customer info -->
                <div class="card mb-4">
                    <div class="card-header"><i class="bi bi-person"></i> Customer Information</div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="text-muted small">Full Name</label>
                                <div class="fw-bold" id="custName">Loading...</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="text-muted small">Email Address</label>
                                <div class="fw-bold" id="custEmail">Loading...</div>
                            </div>
                             <div class="col-md-6 mb-3">
                                <label class="text-muted small">Phone Number</label>
                                <div class="fw-bold" id="custPhone">Loading...</div>
                            </div>
                             <div class="col-md-6 mb-3">
                                <label class="text-muted small">Nationality</label>
                                <div class="fw-bold" id="custNationality">Loading...</div>
                            </div>
                            <div class="col-12">
                                <label class="text-muted small">Address</label>
                                <div class="fw-bold" id="custAddress">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>

                 <!-- Tour info -->
                <div class="card mb-4">
                    <div class="card-header"><i class="bi bi-map"></i> Tour Information</div>
                    <div class="card-body">
                        <div class="row">
                             <div class="col-12 mb-3">
                                <label class="text-muted small">Tour Name</label>
                                <div class="fw-bold fs-5 text-primary" id="tourName">Loading...</div>
                            </div>
                             <div class="col-md-4 mb-3">
                                <label class="text-muted small">Start Date</label>
                                <div class="fw-bold" id="tourStartDate">Loading...</div>
                            </div>
                             <div class="col-md-4 mb-3">
                                <label class="text-muted small">Duration</label>
                                <div class="fw-bold" id="tourDuration">Loading...</div>
                            </div>
                             <div class="col-md-4 mb-3">
                                <label class="text-muted small">Participants</label>
                                <div class="fw-bold" id="participantsCount">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Payment & Actions -->
            <div class="col-md-4">
                 <!-- Actions -->
                <div class="card mb-4 border-primary">
                    <div class="card-header bg-soft-primary text-primary"><i class="bi bi-lightning-charge"></i> Quick Actions</div>
                    <div class="card-body">
                        <div id="actionButtons" class="d-grid gap-2">
                            <!-- Buttons injected via JS -->
                        </div>
                        <button class="btn btn-outline-primary w-100 mt-2" onclick="bookingManager.showPaymentModal()">
                            <i class="bi bi-cash-coin"></i> Add Payment
                        </button>
                    </div>
                </div>

                <!-- Payment Info -->
                <div class="card mb-4">
                    <div class="card-header"><i class="bi bi-credit-card"></i> Payment & Pricing</div>
                    <div class="card-body">
                        <div class="mb-3">
                             <label class="text-muted small d-block">Payment Method</label>
                             <span class="badge bg-secondary" id="paymentMethod">Loading...</span>
                        </div>
                         <div class="mb-3">
                             <label class="text-muted small d-block">Payment Status</label>
                             <span class="text-uppercase fw-bold" id="paymentStatus">Loading...</span>
                        </div>
                         <div class="mb-3">
                             <label class="text-muted small d-block">Deposit</label>
                             <div class="d-flex justify-content-between align-items-center">
                                <span id="depositStatus">Loading...</span>
                                <small class="text-muted" id="depositAmount">Required: $0</small>
                             </div>
                        </div>
                        <hr>
                        <div id="pricingBreakdown">
                            <!-- Pricing injected via JS -->
                        </div>
                    </div>
                </div>

                <!-- History -->
                <div class="card">
                     <div class="card-header"><i class="bi bi-clock-history"></i> Status History</div>
                     <div class="card-body">
                         <div id="statusHistory" class="small">
                             <!-- History injected via JS -->
                         </div>
                     </div>
                </div>
            </div>
        </div>
      </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="paymentForm">
                        <div class="mb-3">
                            <label class="form-label">Amount</label>
                            <input type="number" class="form-control" id="paymentAmount" required min="1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Payment Method</label>
                            <select class="form-select" id="paymentMethodInput" required>
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="credit_card">Credit Card</option>
                                <option value="cash">Cash</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Transaction ID / Note</label>
                            <input type="text" class="form-control" id="paymentNote">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="bookingManager.submitPayment()">Save Payment</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/api.js"></script>
    <script src="/assets/js/admin-utils.js"></script>
    <script src="/assets/js/auth-middleware.js"></script>
    <script src="/assets/js/booking-admin.js"></script>
    <script src="/assets/js/sidebar-toggle.js"></script>
    <script>
      // Init page
      document.addEventListener("DOMContentLoaded", async () => {
        const hasAccess = await AuthMiddleware.requirePermission("booking:view");
        if (!hasAccess) return;

        await AuthMiddleware.setupPermissionUI();
        bookingManager.initDetailPage();
      });
    </script>
  </body>
</html>
